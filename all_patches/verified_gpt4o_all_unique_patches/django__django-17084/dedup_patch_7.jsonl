{"model_name_or_path": "agentless", "instance_id": "django__django-17084", "model_patch": "diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py\nindex ac042d4..099c951 100644\n--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -235,6 +235,11 @@ class BaseExpression:\n           Where `sql` is a string containing ordered sql parameters to be\n           replaced with the elements of the list `params`.\n         \"\"\"\n+        if self.contains_over_clause and any(expr.contains_aggregate for expr in self.get_source_expressions()):\n+            raise NotImplementedError(\n+                \"PostgreSQL does not allow aggregate functions to contain window function calls. \"\n+                \"Modify your query to avoid using window functions within aggregates.\"\n+            )\n         raise NotImplementedError(\"Subclasses must implement as_sql()\")\n \n     @cached_property\n"}
