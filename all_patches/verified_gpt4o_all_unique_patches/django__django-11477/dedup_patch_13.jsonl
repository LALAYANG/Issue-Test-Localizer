{"model_name_or_path": "agentless", "instance_id": "django__django-11477", "model_patch": "diff --git a/django/urls/resolvers.py b/django/urls/resolvers.py\nindex 58da200..778fe57 100644\n--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -469,12 +469,20 @@ class URLResolver:\n                         for name in url_pattern.reverse_dict:\n                             for matches, pat, defaults, converters in url_pattern.reverse_dict.getlist(name):\n                                 new_matches = normalize(p_pattern + pat)\n+                                final_defaults = {**defaults, **url_pattern.default_kwargs}\n+                                new_pat = p_pattern + pat\n+                                \n+                                # Handle missing optional named groups\n+                                if isinstance(new_pat, str):\n+                                    for key in final_defaults.keys():\n+                                        new_pat = new_pat.replace(f\"(?P<{key}>[^/]+)?\", f\"(?P<{key}>{final_defaults[key]})?\")\n+                                \n                                 lookups.appendlist(\n                                     name,\n                                     (\n                                         new_matches,\n-                                        p_pattern + pat,\n-                                        {**defaults, **url_pattern.default_kwargs},\n+                                        new_pat,\n+                                        final_defaults,\n                                         {**self.pattern.converters, **url_pattern.pattern.converters, **converters}\n                                     )\n                                 )\n"}
