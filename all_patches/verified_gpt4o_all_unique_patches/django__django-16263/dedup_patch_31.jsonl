{"model_name_or_path": "agentless", "instance_id": "django__django-16263", "model_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex ab02d72..a686f1c 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -550,6 +550,20 @@ class Query(BaseExpression):\n         Perform a COUNT() query using the current filter constraints.\n         \"\"\"\n         obj = self.clone()\n+        # Clear any annotations that are not used in filter or ordering\n+        if obj.annotations:\n+            annotations_to_keep = set()\n+            if obj.group_by:\n+                annotations_to_keep.update(obj.group_by)\n+            if obj.order_by:\n+                annotations_to_keep.update(obj.order_by)\n+            if obj.where:\n+                annotations_to_keep.update(obj.where.get_group_by_cols())\n+\n+            for alias in list(obj.annotations):\n+                if alias not in annotations_to_keep:\n+                    del obj.annotations[alias]\n+\n         obj.add_annotation(Count(\"*\"), alias=\"__count\", is_summary=True)\n         return obj.get_aggregation(using, [\"__count\"])[\"__count\"]\n \n", "occurrence": 1}
