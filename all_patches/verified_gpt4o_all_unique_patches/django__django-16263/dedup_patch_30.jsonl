{"model_name_or_path": "agentless", "instance_id": "django__django-16263", "model_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 8207ea2..a6b77c3 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -289,6 +289,9 @@ class Query(BaseExpression):\n         return dict(zip(outer_query.annotation_select, result))\n     def get_count(self, using):\n         obj = self.clone()\n+        if obj.annotation_select:\n+            annotations_to_keep = {alias for alias, annotation in obj.annotations.items() if obj.where.contains_aggregate(annotation) or obj.group_by is True or any((alias in expr.refs for expr in obj.annotations.values()))}\n+            obj.set_annotation_mask(annotations_to_keep)\n         obj.add_annotation(Count('*'), alias='__count', is_summary=True)\n         return obj.get_aggregation(using, ['__count'])['__count']\n     def has_filters(self):"}
