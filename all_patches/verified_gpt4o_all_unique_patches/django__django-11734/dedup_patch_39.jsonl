{"model_name_or_path": "agentless", "instance_id": "django__django-11734", "model_patch": "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex 4d8d3aa..6f78243 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -90,8 +90,11 @@ class Q(tree.Node):\n     def resolve_expression(self, query=None, allow_joins=True, reuse=None, summarize=False, for_save=False):\n         # We must promote any new joins to left outer joins so that when Q is\n         # used as an expression, rows aren't filtered due to joins.\n+        if hasattr(query, 'external_aliases'):\n+            self._check_external_aliases(query)\n         clause, joins = query._add_q(self, reuse, allow_joins=allow_joins, split_subq=False)\n         query.promote_joins(joins)\n+        query.promote_joins(joins)\n         return clause\n \n     def deconstruct(self):\n", "occurrence": 1}
