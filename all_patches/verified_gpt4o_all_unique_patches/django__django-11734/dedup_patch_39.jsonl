{"model_name_or_path": "agentless", "instance_id": "django__django-11734", "model_patch": "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex 32f88b1..c69cc50 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -46,8 +46,11 @@ class Q(tree.Node):\n         obj.negate()\n         return obj\n     def resolve_expression(self, query=None, allow_joins=True, reuse=None, summarize=False, for_save=False):\n+        if hasattr(query, 'external_aliases'):\n+            self._check_external_aliases(query)\n         clause, joins = query._add_q(self, reuse, allow_joins=allow_joins, split_subq=False)\n         query.promote_joins(joins)\n+        query.promote_joins(joins)\n         return clause\n     def deconstruct(self):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)"}
