{"model_name_or_path": "agentless", "instance_id": "django__django-15973", "model_patch": "diff --git a/django/db/models/fields/related.py b/django/db/models/fields/related.py\nindex 19949c1..1711d19 100644\n--- a/django/db/models/fields/related.py\n+++ b/django/db/models/fields/related.py\n@@ -1350,19 +1350,20 @@ class ManyToManyField(RelatedField):\n         swappable=True,\n         **kwargs,\n     ):\n+        if isinstance(to, str) and not to.startswith(settings.INSTALLED_APPS):\n+            to = \"%s.%s\" % (self.model._meta.app_label, to)\n         try:\n-            to._meta\n-        except AttributeError:\n-            if not isinstance(to, str):\n-                raise TypeError(\n-                    \"%s(%r) is invalid. First parameter to ManyToManyField \"\n-                    \"must be either a model, a model name, or the string %r\"\n-                    % (\n-                        self.__class__.__name__,\n-                        to,\n-                        RECURSIVE_RELATIONSHIP_CONSTANT,\n-                    )\n+            to = self.opts.apps.get_model(to)\n+        except (LookupError, TypeError):\n+            raise TypeError(\n+                \"%s(%r) is invalid. First parameter to ManyToManyField \"\n+                \"must be either a model, a model name, or the string %r\"\n+                % (\n+                    self.__class__.__name__,\n+                    to,\n+                    RECURSIVE_RELATIONSHIP_CONSTANT,\n                 )\n+            )\n \n         if symmetrical is None:\n             symmetrical = to == RECURSIVE_RELATIONSHIP_CONSTANT\n", "occurrence": 1}
